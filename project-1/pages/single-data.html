<!DOCTYPE html>
<html>

<head>
    <title>D3 Project Starter Template</title>
    <meta charset="UTF-8">
    <link rel="icon" href="data:;base64,iVBORwOKGO=" />
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+JP:wght@500;700&display=swap" rel="stylesheet">
    <link rel="stylesheet" type="text/css" href="../style/main.css" />
    <script src="https://cdn.jsdelivr.net/npm/sweetalert2@11"></script>

</head>

<body>
    <!-- Add HTML content, SVG drawing area, ... -->
    <style>
        #country-filters {
            border: 1px solid #ccc;
            padding: 10px;
            width: 250px;
            max-height: 600px;
            overflow-y: auto;
            margin-bottom: 20px;
        }

        #country-filters input[type="text"] {
            width: 100%;
            margin-bottom: 10px;
            padding: 5px;
            box-sizing: border-box;
        }

        .checkbox-list label {
            display: block;
            margin: 2px 0;
            cursor: pointer;
        }

        .tooltip {
            position: absolute;
            pointer-events: none;
            background-color: rgba(0, 0, 0, 0.7);
            color: #fff;
            padding: 8px;
            border-radius: 4px;
            font-size: 12px;
            display: none;
        }

        #chart-container {
            max-width: 100%;
            /* fills horizontal space */
            height: 0%;
            /* or any relative height like viewport height */
            min-height: 600px;
            /* optional fallback */
            position: relative;
            /* helps with tooltips */
            margin-bottom: clamp(0rem, 0vw, 0rem);
        }

        /* Styling for the dropdown */
        #variable-dropdown {
            margin: 10px;
            padding: 10px 20px;
            font-size: 16px;
            border: none;
            border-radius: 50px;
            background: linear-gradient(135deg, #4b4b4e, #848691);
            color: white;
            cursor: pointer;
            transition: background-color 0.3s ease, box-shadow 0.3s ease;
            box-shadow: 0px 4px 10px rgba(0, 0, 0, 0.1);
            background-color: #4b4b4e;
        }

        #variable-dropdown:hover {
            background-color: #8c8d97;
            box-shadow: 0px 6px 15px rgba(0, 0, 0, 0.2);
        }

        #variable-dropdown:focus {
            outline: none;
            border: 2px solid #b1b1b4;
        }

        /* Position the dropdown on the right */
        #dropdown-container {
            display: flex;
            justify-content: flex-end;
            margin-bottom: 20px;
        }

        /* Adjust for responsiveness */
        @media (max-width: 768px) {
            #dropdown-container {
                justify-content: center;
                /* Center on smaller screens */
                margin-top: 10px;
            }

            #variable-dropdown {
                width: 100%;
                /* Full width on smaller screens */
                max-width: 250px;
            }
        }
    </style>

    <header>
        <h2>My Portfolio</h2>
        <nav>
            <a href="../index.html">Home</a>
            <a href="#">Single Statistic Charts</a>
            <a href="../pages/comparative-data.html">Comparative Analysis Charts</a>
        </nav>
    </header>

    <h1>Single Statistic Chart Visualization</h1>

    <!-- Country selector (search + checkboxes) -->
    <div id="page-content">

        <div id="dropdown-container">
            <label for="variable-dropdown"
                style="font-weight: bold; display: flex; align-items: center; justify-content: center;">Select Data
                Variable:</label>
            <select id="variable-dropdown">
                <option value="medianAge">Median Age</option>
                <option value="populationGrowth">Population Growth Rate</option>
                <option value="population">Population</option>
                <option value="lifeExpectancy">Life Expectancy</option>

                <!-- Add more options as needed -->
            </select>
        </div>

        <div id="chart-container" style="display: flex; gap: 20px; width: 100%; overflow: auto;">
            <svg id="scatterplot" style="flex: 1; overflow: auto;"></svg>
            <div id="country-filters"></div>
        </div>
        <hr class="modern-divider" style=" border:noon; height: 3px; background: linear-gradient(to right, #cfe2f2, #0d306b, #cfe2f2); margin: 40px 0; opacity: 0.9;">

        <div id="chart-container"><svg id="barchart"></svg></div>

        <div id="tooltip"
            style="position:absolute; display:none; background:#fff; border:1px solid #aaa; padding:10px; pointer-events:none;">
        </div>

        <svg id="chart"></svg>
<hr class="modern-divider" style=" border:noon; height: 3px; background: linear-gradient(to right, #cfe2f2, #0d306b, #cfe2f2); margin: 40px 0; opacity: 0.9;">
        <div id="map"></div>

        <div class="source">
            Source: Data from <a href="https://ourworldindata.org/">Our World in Data</a>
        </div>

        <hr class="modern-divider" style=" border:noon; height: 3px; background: linear-gradient(to right, #cfe2f2, #0d306b, #cfe2f2); margin: 40px 0; opacity: 0.9;">
        <section id="linked-highlight-charts" style="margin-top: 24px;">
            <div id="linked-year-controls-host"></div>
            <div style="display: flex; gap: 20px; width: 100%; align-items: stretch;">
                <svg id="linked-scatterplot" style="flex: 1; min-height: 420px; min-width: 420px;"></svg>
                <svg id="linked-barchart" style="flex: 1; min-height: 430px; min-width: 420px;"></svg>
            </div>
            <div style="margin-top: 40px;">
                <div id="linked-choropleth-map" style="width: 100%; height: 600px;"></div>
            </div>
        </section>

        <!-- D3 bundle -->
        <script src="../js/d3.v6.min.js"></script>
        <script src="../js/countryselect.js"></script>
        <script src="../js/countryIso.js"></script>
        <script src="../js/brushSelection.js"></script>
        <script src="../js/scatterplot.js"></script>
        <script src="../js/barchart.js"></script>
        <script src="../js/focusContextVis.js"></script>
        <!-- Our JS code - INCLUDING the new files-->
        <script src="../js/choroplethMap.js"></script>
        <script src="../js/topojson.v3.js"></script>
        <script src="../js/single-data-main.js"></script>
        <script src="../js/linked-highlight-charts.js"></script>
    </div>

    <script>
        function showPopup() {
            Swal.fire({
                title: 'Welcome!',
                text: 'Feel free to explore the data visualizations. If you want to compare the world data against a single coutntry, select the country from the dropdown menu on the right and select world. Life expectancy data more limited then the rest and might not be available for all countries and doesn\'t have any predictive data.',
                icon: 'info',
                confirmButtonText: 'Cool',
                customClass: {
                    popup: 'custom-popup',         // Apply your CSS to the popup container
                    title: 'custom-popup-title',   // Optional: style title
                    content: 'custom-popup-text',  // Optional: style text
                    confirmButton: 'custom-popup-button' // Style the button
                },
                buttonsStyling: false // Disable default SweetAlert2 button styles
            });
        }


        window.addEventListener('DOMContentLoaded', () => {
            showPopup();
        });

        window.addEventListener('DOMContentLoaded', () => {
            const dataOptions = {
                medianAge: {
                    csvPath: '../data/median-age.csv',
                    entityColumn: 'Entity',
                    codeColumn: 'Code',
                    yearColumn: 'Year',
                    actualColumn: 'Median age, total',
                    projectedColumn: 'Median age (Projected)'
                },
                populationGrowth: {
                    csvPath: '../data/population-growth-rates.csv',
                    entityColumn: 'Entity',
                    codeColumn: 'Code',
                    yearColumn: 'Year',
                    actualColumn: 'Growth rate, total',
                    projectedColumn: 'Population growth rate (%) (Projected)'
                },
                population: {
                    csvPath: '../data/population-with-un-projections.csv',
                    entityColumn: 'Entity',
                    codeColumn: 'Code',
                    yearColumn: 'Year',
                    actualColumn: 'Population, total',
                    projectedColumn: 'Population, medium projection (Projected)'
                },
                lifeExpectancy: {
                    csvPath: '../data/life-expectancy.csv',
                    entityColumn: 'Entity',
                    codeColumn: 'Code',
                    yearColumn: 'Year',
                    actualColumn: 'Life expectancy',
                    projectedColumn: ''
                }
            };

            let linkedChartsController = null;

            async function mountLinkedCharts(optionKey) {
                const option = dataOptions[optionKey] || dataOptions.medianAge;
                if (!window.HighlightedCountryCharts || !option) return;

                if (linkedChartsController && typeof linkedChartsController.destroy === 'function') {
                    linkedChartsController.destroy();
                    linkedChartsController = null;
                }

                linkedChartsController = await window.HighlightedCountryCharts.init({
                    csvPath: option.csvPath,
                    scatterplotSelector: '#linked-scatterplot',
                    barchartSelector: '#linked-barchart',
                    choroplethSelector: '#linked-choropleth-map',
                    geoDataPath: '../data/worldgeo.json',
                    yearControlsHostSelector: '#linked-year-controls-host',
                    yearInputSelector: '#linked-year-input-bottom',
                    yearLabelSelector: '#linked-year-label-bottom',
                    countryFilterSelector: '#country-filters',
                    entityColumn: option.entityColumn,
                    codeColumn: option.codeColumn,
                    yearColumn: option.yearColumn,
                    actualColumn: option.actualColumn,
                    projectedColumn: option.projectedColumn,
                    useExistingCountrySelector: true,
                    defaultSelectedCodes: ['USA', 'CHN', 'IND']
                });
            }

            const dropdown = document.getElementById('variable-dropdown');
            const initialKey = dropdown ? dropdown.value : 'medianAge';

            setTimeout(() => {
                mountLinkedCharts(initialKey).catch(console.error);
            }, 250);

            if (dropdown) {
                dropdown.addEventListener('change', (event) => {
                    mountLinkedCharts(event.target.value).catch(console.error);
                });
            }
        });
    </script>

</body>

</html>